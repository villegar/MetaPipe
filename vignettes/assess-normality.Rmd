---
title: "Assess Normality"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Assess Normality}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r rmd-options, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"#,
  # fig.path = "man/figures/assess-normality-",
  # out.width = "100%"
)

options(knitr.kable.NA = '')
hcolor <- "#363B74"
tcolor <- "#EEEEEE"

knitr::opts_chunk$set(dpi = 300, fig.width = 7)
```

```{r setup}
library(MetaPipe)
```

`MetaPipe` assesses the normality of variables (traits) by performing a 
Shapiro-Wilk test on the raw data (see [Load Raw Data](load-raw-data.html) and 
[Replace Missing Data](replace-missing-data.html)). Based on whether or not the
data approximates a normal distribution, an array of transformations will be 
computed, and the normality assessed one more time.

The diagram below shows the tree of transformations that can be performed, the
user can specify the transformation values passing a vector with the argument 
`transf_vals` to the function `assess_normality`; by 
default, `[2, e, 3, 4, 5, 6, 7, 8, 9, 10]`.

```{r assess-normality-diagram, echo = FALSE, out.width = "50%"}
DiagrammeR::grViz(system.file("figures/assess-normality-graph.gv", package = "MetaPipe"), height = "200px", width = "100%")
```

The function call is as follows:
```{r assess-normality-fx-call, eval = FALSE}
assess_normality(raw_data = example_data, 
                 excluded_columns = c(2), 
                 # Optional
                 cpus = 1, 
                 out_prefix = "metapipe", 
                 plots_dir = getwd(), 
                 transf_vals = c(2, exp(1), 3, 4, 5, 6, 7, 8, 9, 10))
```

where `raw_data` is a data frame containing the raw data, as described in 
[Load Raw Data](load-raw-data.html) and `excluded_columns` is a vector containing 
the indices of the properties, e.g. `c(2, 3, ..., M)`. The other arguments are 
optional, `cpus` is the number of cores to use, in other words, the number of 
concurrent traits to process, `out_prefix` is the prefix for output files, 
`plots_dir` is the output directory where the plots will be stored, and 
`transf_vals` is a vector containing the transformation values to be used when 
transforming the original data.

```{r assess-normality-example-data-before, echo = FALSE, fig.align = 'center', out.width = "60%"}
set.seed(123)
test_data <- rnorm(500)
MetaPipe::generate_hist(exp(1)^test_data, NULL, xlab = latex2exp::TeX("e^{data}"), save = FALSE, alpha = 1, fill = hcolor)

MetaPipe::generate_hist(log(exp(1)^test_data), NULL, xlab = latex2exp::TeX("ln(e^{data})"), save = FALSE, alpha = 1, fill = hcolor)

MetaPipe::generate_hist(test_data, NULL, xlab = latex2exp::TeX("data"), save = FALSE, alpha = 1, fill = hcolor)
```